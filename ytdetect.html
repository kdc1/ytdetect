<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube URL/ID 입력 폼 + 차단 감지 예제</title>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background-color: #fafafa;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    h1 {
      margin-bottom: 1rem;
      color: #444;
    }

    form {
      display: flex;
      margin-bottom: 1rem;
    }

    input[type="text"] {
      width: 320px;
      padding: 0.5rem;
      border: 1px solid #bbb;
      border-radius: 4px 0 0 4px;
      outline: none;
      font-size: 1rem;
    }

    input[type="text"]:focus {
      border-color: #0073e6;
    }

    button {
      padding: 0.5rem 1rem;
      background-color: #0073e6;
      color: white;
      font-size: 1rem;
      border: none;
      border-radius: 0 4px 4px 0;
      cursor: pointer;
    }

    button:hover {
      background-color: #005bb5;
    }

    #player {
      width: 560px;
      height: 315px;
      background-color: #000;
      border: 1px solid #ccc;
      margin-top: 1rem;
    }

    #statusMessage {
      margin-top: 1rem;
      color: #d32f2f;
      font-weight: bold;
      min-height: 1.2em;
    }
  </style>
</head>
<body>
  <h1>영상 URL 또는 영상 ID 입력 후 재생하기</h1>

  <!-- 1. 입력폼: URL 또는 ID 입력 -->
  <form id="videoForm">
    <input
      type="text"
      id="videoInput"
      placeholder="유튜브 영상 URL 또는 ID를 입력하세요"
      autocomplete="off"
      required
    />
    <button type="submit">재생</button>
  </form>

  <!-- 2. YouTube Player가 로드될 영역 -->
  <div id="player"></div>

  <!-- 3. 에러/상태 메시지 -->
  <div id="statusMessage"></div>

  <!-- 4. YouTube IFrame API 로드 -->
  <script>
    // ------------------------------------------------------------
    // 4-1. API 스크립트를 비동기로 불러오기
    // ------------------------------------------------------------
    var tag = document.createElement("script");
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScript = document.getElementsByTagName("script")[0];
    firstScript.parentNode.insertBefore(tag, firstScript);

    // ------------------------------------------------------------
    // 전역 변수 선언
    // ------------------------------------------------------------
    var player = null;      // YT.Player 인스턴스
    var apiReady = false;   // IFrame API가 로드되었는지 여부

    // ------------------------------------------------------------
    // 4-2. API 준비 완료 콜백 (YouTube가 자동으로 호출)
    // ------------------------------------------------------------
    function onYouTubeIframeAPIReady() {
      apiReady = true;
      console.log("YouTube IFrame API 로드 완료");
      // 아직 영상 ID가 없으므로 플레이어를 생성하지 않음.
      // 사용자가 버튼을 누르면 createOrLoadPlayer()를 호출.
    }

    // ------------------------------------------------------------
    // 5. 폼 제출 이벤트 처리
    // ------------------------------------------------------------
    document.getElementById("videoForm").addEventListener("submit", function (e) {
      e.preventDefault();
      var rawValue = document.getElementById("videoInput").value.trim();
      if (!rawValue) return;

      var videoId = extractVideoID(rawValue);
      if (!videoId) {
        displayMessage("⚠️ 올바른 유튜브 URL 또는 ID를 입력해주세요.");
        return;
      }

      createOrLoadPlayer(videoId);
    });

    // ------------------------------------------------------------
    // 6. URL 또는 ID에서 실제 Video ID만 추출하는 함수
    // ------------------------------------------------------------
    function extractVideoID(urlOrId) {
      // 11자 ID 형식을 기본으로 하되, URL 패턴이 들어오면 정규표현식으로 ID를 꺼냄
      var id = urlOrId;
      var regExp = /^.*(?:youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#&?]{11}).*/;
      var match = id.match(regExp);
      if (match && match[1]) {
        return match[1];
      }
      // 만약 길이가 11자인 ID라고 가정할 수 있으면 그대로 반환
      if (/^[A-Za-z0-9_-]{11}$/.test(id)) {
        return id;
      }
      return null;
    }

    // ------------------------------------------------------------
    // 7. 플레이어 생성 또는 이미 있으면 로드만 하는 함수
    // ------------------------------------------------------------
    function createOrLoadPlayer(videoId) {
      // 메시지 초기화
      clearMessage();

      if (!apiReady) {
        displayMessage("🔄 YouTube API 로드 중입니다. 잠시만 기다려주세요...");
        return;
      }

      if (player === null) {
        // 최초로 플레이어 생성
        player = new YT.Player("player", {
          videoId: videoId, // 입력받은 영상 ID
          playerVars: {
            rel: 0,
            modestbranding: 1,
          },
          events: {
            onReady: onPlayerReady,
            onError: onPlayerError,
          },
        });
      } else {
        // 이미 플레이어가 있으면 새로운 ID 로드
        player.loadVideoById(videoId);
      }
    }

    // ------------------------------------------------------------
    // 8. 플레이어 준비 완료 콜백
    // ------------------------------------------------------------
    function onPlayerReady(event) {
      console.log("플레이어 준비 완료 -> 영상 재생 시도");
      event.target.playVideo();
    }

    // ------------------------------------------------------------
    // 9. 에러 발생 시 호출되는 콜백
    // ------------------------------------------------------------
    function onPlayerError(event) {
      var errorCode = event.data;
      if (errorCode === 101 || errorCode === 150) {
        displayMessage("⚠️ 이 영상은 외부 웹사이트에서 재생이 불가능하도록 설정되었습니다.");
      } else if (errorCode === 100) {
        displayMessage("⚠️ 요청하신 영상을 찾을 수 없거나 비공개 처리되었습니다. (Error 100)");
      } else {
        displayMessage("⚠️ 알 수 없는 오류가 발생했습니다. (Error " + errorCode + ")");
      }
      console.error("YouTube Player Error 코드:", errorCode);
    }

    // ------------------------------------------------------------
    // 10. 상태 메시지를 표시/초기화하는 헬퍼 함수
    // ------------------------------------------------------------
    function displayMessage(text) {
      var msgEl = document.getElementById("statusMessage");
      msgEl.textContent = text;
    }
    function clearMessage() {
      var msgEl = document.getElementById("statusMessage");
      msgEl.textContent = "";
    }
  </script>
</body>
</html>
